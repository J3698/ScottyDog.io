<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" type="text/css" href=".\style.css">
</head>
<body background=".\images/Plaid.jpeg" style="overflow: hidden">
    <img id="scream" width="16" height="16" src=".\images\Scotty-Dog-L.png" alt="The Scream">
    <img id="scary" width="16" height="16" src=".\images\Scotty-Dog-R.png" alt="The Scream">
    <img id="enemyL" width="16" height="16" src=".\images\White-Scotty-L.png" alt="The Scream">
    <img id="enemyR" width="16" height="16" src=".\images\White-Scotty-R.png" alt="The Scream?">
    <img id="usb" width="16" height="16" src=".\images\Flash-Drive.png" alt="The Scream?">
    <img id="book" width="16" height="16" src=".\images\Plaid-Book.png" alt="The Scream?!">
    
    
    <canvas id="myCanvas" width="375" height="250" style="width: 100vh; height: 66vh; border:20px solid #d3d3d3; background-color: solid #d3d3d3;">
    </canvas>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        var socket = io();
        
        var img = document.getElementById("scream");
        var Rimg = document.getElementById("scary");
        var en = document.getElementById("enemyL");
        var bimg = document.getElementById("book");
        
        var c = document.getElementById("myCanvas");
        var ctx = c.getContext("2d");
        
        window.onload = function() {
            
        var tempid = prompt("Name your character");
        socket.emit('checkName', tempid)
        var id = tempid;
        
            
        socket.on('update', function(thing) {
            drawScreen(thing[0], thing[1]);
        });
        
        socket.emit('getId', id );
        

        document.addEventListener('keydown', function(event) {
            if(event.keyCode == 37) {
                //Left
                img = document.getElementById("scream");
                socket.emit('move', 1);
            }
            else if(event.keyCode == 38) {
                //Up
                socket.emit('move', 2);
            }
            else if(event.keyCode == 39) {
                //Right
                img = document.getElementById("scary");
                socket.emit('move', 3);
            }
            else if(event.keyCode == 40) {
                //Down
                socket.emit('move', 4);
            }
            else if(event.keyCode == 32)
            {  
                //Shoot USB
                socket.emit('shoot');
            }
            console.log(event.keyCode);
        });
        
        
        
            function drawScreen(players, books)
            {
                var int = -1;
                for (var i = 0; i < players.length; i++)
                {
                    if (players[i].id == id)
                    {
                        int = i;
                    }
                }
                
                var xmod = players[int].posx;
                var ymod = players[int].posy;
                
                
                ctx.clearRect(0,0,myCanvas.width,myCanvas.height);
                ctx.fillStyle = 'rgb(100,100,100, 0.9)';
                ctx.fillRect(0,0,myCanvas.width, myCanvas.height);
                for (var i = 0; i < players.length; i++) {
                    
                    var newX = (players[i].posx - xmod + myCanvas.width/2);
                    var newY = (players[i].posy - ymod + myCanvas.height/2);
                    
                    
                    if (players[i].dir == 1){
                        en = document.getElementById("enemyL");
                    }
                    else if (players[i].dir == 3){
                        en = document.getElementById("enemyR");
                    }
                    if (id == players[i].id){
                        console.log(players[i].posx, players[i].posy);
                        ctx.drawImage(img, newX, newY, 16, 16);
                        ctx.font = "10px Arial";
                        ctx.fillStyle = "#EEEEEE";
                        ctx.fillText(id, newX, newY + 5);
                    }
                    else{
                        ctx.drawImage(en, newX, newY, 16, 16);
                        ctx.font = '10px Arial';
                        ctx.fillStyle = "#EEEEEE";
                        ctx.fillText(players[i].id, newX, newY + 5);
                    }
                }
                
                
                for (var j = 0; j < books.length; j++){
                    ctx.drawImage(bimg, books[j].posx - xmod + myCanvas.width/2, books[j].posy - ymod + myCanvas.height/2, 16, 16);
                }
                
                //Scoreboard
                var y = 20;
                ctx.font = "10px Arial";
                ctx.fillStyle = "#EEEEEE";
                ctx.fillText('SCOREBOARD', 300, 10);
                
                var onBoard = false;
                
                for (var i = 0; i < 6; i++) {
                    if (i < players.length)
                    {
                        if (i == int)
                        {
                            onBoard = true;
                            ctx.fillStyle = 'blue';
                            ctx.fill(players[i].id + '   ' + players[i].score, 300, y+ 10*i);
                        }
                        else
                        {
                            ctx.fillStyle = "#EEEEE";
                            ctx.fillText(players[i].id + '   ' + players[i].score, 300, y + 10*i);
                        }
                    }
                }
                
                if (!onBoard)
                {
                    ctx.fillStyle = 'blue';
                    ctx.fill(players[int].id + '   ' + players[int].score, 300, y + 60);
                }
            }
        };
        </script>
    </body>
</html>
